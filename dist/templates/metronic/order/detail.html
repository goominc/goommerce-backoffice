<div class="page-head">
  <div class="container">
    <div id="contentTitle"></div> <!-- commonly initialized -->
  </div>
</div>
<div class="page-content">
  <div class="container">
    <div id="breadcrumb"></div> <!-- commonly initialized -->
    <div class="page-content-inner">
      <div class="row">
        <div class="col-md-12">
          <div class="portlet light">
            <div class="portlet-title">
              {{order.id}}
            </div>
            <div class="portlet-body">
              <div class="row">
                <div class="col-md-4">
                  <div class="portlet yellow-crusta box">
                    <div class="portlet-title">
                      <div class="caption">
                        <i class="fa fa-cogs"></i>주문 상세 정보
                      </div>
                      <div class="actions btn-set">
                        <button class="btn blue" ng-click="saveStatus()"><i class="fa fa-check"></i> {{'order.detail.saveButton' | translate}}</button>
                      </div>
                    </div>
                    <div class="portlet-body">
                      <div class="row static-info">
                        <div class="col-md-5 name">
                          Order #:
                        </div>
                        <div class="col-md-7 value">
                          {{order.id}} <!--span class="label label-info label-sm">Email confirmation was sent </span-->
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-5 name">
                          Order Time:
                        </div>
                        <div class="col-md-7 value">
                          {{order.createdAt}}
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-5 name">
                          Order Status:
                        </div>
                        <div class="col-md-7 value">
                          <div class="form-group">
                            <select class="form-control" id="sel1" data-ng-model="order.status" convert-to-number>
                              <option value="0">{{translateOrderStatus(0)}}</option>
                              <option value="100">{{translateOrderStatus(100)}}</option>
                              <option value="101">{{translateOrderStatus(101)}}</option>
                              <option value="102">{{translateOrderStatus(102)}}</option>
                              <option value="200">{{translateOrderStatus(200)}}</option>
                              <option value="201">{{translateOrderStatus(201)}}</option>
                              <option value="202">{{translateOrderStatus(202)}}</option>
                              <option value="203">{{translateOrderStatus(203)}}</option>
                              <option value="300">{{translateOrderStatus(300)}}</option>
                              <option value="400">{{translateOrderStatus(400)}}</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-5 name">
                          Payment Status:
                        </div>
                        <div class="col-md-7 value">
                          <span class="label label-success">{{translateOrderPaymentStatus(order.paymentStatus)}}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="portlet blue-hoki box">
                    <div class="portlet-title">
                      <div class="caption">
                        <i class="fa fa-cogs"></i>고객 정보
                      </div>
                    </div>
                    <div class="portlet-body">
                      <div class="row static-info">
                        <div class="col-md-5 name">
                          유저 이름:
                        </div>
                        <div class="col-md-7 value">
                          {{user.name}}
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-5 name">
                          이메일:
                        </div>
                        <div class="col-md-7 value">
                          {{user.email}}
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-5 name">
                          사업자 번호:
                        </div>
                        <div class="col-md-7 value">
                          {{user.data.bizNumber}}
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-5 name">
                          전화번호:
                        </div>
                        <div class="col-md-7 value">
                          {{user.data.tel}}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="portlet red-sunglo box">
                    <div class="portlet-title">
                      <div class="caption">
                        <i class="fa fa-cogs"></i>Shipping Address
                      </div>
                      <div class="actions btn-set">
                        <button class="btn blue" ng-click="saveAddress()"><i class="fa fa-check"></i> {{'order.detail.saveButton' | translate}}</button>
                      </div>
                    </div>
                    <div class="portlet-body">
                      <div class="row static-info">
                        <div class="col-md-12 value">
                          <div data-ng-repeat="field in addressFields">{{field.title}}: {{field.obj}}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="portlet yellow-crusta box">
                    <div class="portlet-title">
                      <div class="caption">
                        <i class="fa fa-cogs"></i>Total Details
                      </div>
                    </div>
                    <div class="portlet-body">
                      <div class="row static-info">
                        <div class="col-md-3 name">
                        </div>
                        <div class="col-md-3 value">
                          original
                        </div>
                        <div class="col-md-3 value">
                          final
                        </div>
                        <div class="col-md-3 value">
                          diff
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-3 name">
                          subtotal:
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.subtotalKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.finalSubtotalKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.subtotalKRW - order.finalSubtotalKRW}}
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-3 name">
                          tax:
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.taxKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.finalTaxKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.taxKRW - order.finalTaxKRW}}
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-3 name">
                          handling fee:
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.handlingFeeKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.finalHandlingFeeKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.handlingFeeKRW - order.finalHandlingFeeKRW}}
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-3 name">
                          shipping cost:
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.shippingCostKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.finalShippingCostKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.shippingCostKRW - order.finalShippingCostKRW}}
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-3 name">
                          adjustment:
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.adjustmentTotalKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.finalAdjustmentTotalKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.adjustmentTotalKRW - order.finalAdjustmentTotalKRW}}
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-3 name">
                          total:
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.totalKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.finalTotalKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.totalKRW - order.finalTotalKRW}}
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-3 name">
                          Payment:
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.totalPaid.amount}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.finalTotalKRW}}
                        </div>
                        <div class="col-md-3 value">
                          KRW {{order.totalPaid.amount - order.finalTotalKRW - order.totalRefuned}} ({{order.totalRefuned}})
                        </div>
                      </div>
                      <div class="row static-info">
                        <div class="col-md-9">
                        </div>
                        <div class="col-md-3 value">
                          <button class="btn blue" data-ng-click="refundOrder()">
                            <i class="fa fa-eject"></i> Refund
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="portlet grey-cascade box">
                    <div class="portlet-title">
                      <div class="caption">
                        <i class="fa fa-cogs"></i>주문 수정
                      </div>
                      <div class="actions btn-set">
                        <button class="btn blue" ng-click="finalize()"><i class="fa fa-check"></i> {{'order.detail.saveButton' | translate}}</button>
                      </div>
                    </div>
                    <div class="portlet-body">
                      <span>예상 배송비: {{order.shippingCostKRW}}, </span>
                      <label class="control-label">최종 배송비</label>
                      <input type="number" data-ng-model="order.finalShippingCostKRW" />
                      <p>가격 조정 목록</p>
                      <div class="table-responsive">
                        <table class="table table-hover table-bordered table-striped">
                          <thead>
                            <th width="30%">브랜드 명</th>
                            <th width="10%">Type</th>
                            <th width="30%">Original</th>
                            <th width="30%">Final</th>
                          </thead>
                          <tbody class="cell-center">
                            <tr data-ng-repeat="row in order.adjustments">
                              <td>
                                {{getBrandName(row.brandId)}}
                              </td>
                              <td>
                                {{row.type}}
                              </td>
                              <td>
                                {{row.KRW}}
                              </td>
                              <td>
                                {{row.finalKRW}}
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <p>상품 목록</p>
                      <div class="table-responsive">
                        <table class="table table-hover table-bordered table-striped">
                          <thead>
                          <tr>
                            <th width="15%">상품ID</th>
                            <th width="15%">상품명</th>
                            <th width="15%">색상</th>
                            <th width="15%">크기</th>
                            <th width="10%">주문(최초) 가격</th>
                            <th width="10%">가격</th>
                            <th width="10%">주문(최초 수량)</th>
                            <th width="10%">Total</th>
                            <th width="10%">Final Quantity</th>
                            <th width="10%">Final Total</th>
                            <th width="10%">Status</th>
                          </tr>
                          </thead>
                          <tbody class="cell-center">
                          <tr data-ng-repeat="row in order.orderProducts">
                            <td>
                              <a href="/products/{{row.product.id}}" target="_blank">{{row.product.shortId}}</a>
                            </td>
                            <td>
                              {{row.product.name.ko}}
                            </td>
                            <td>
                              {{row.productVariant.data.color}}
                            </td>
                            <td>
                              {{row.productVariant.data.size}}
                            </td>
                            <td>
                              <span>{{row.productVariant.KRW}} KRW</span>
                            </td>
                            <td>
                              <span>{{row.productVariant.KRW}} KRW</span>
                            </td>
                            <td>
                              {{row.quantity}}
                            </td>
                            <td>
                              {{row.totalKRW}}
                            </td>
                            <td>
                              <input type="number" data-ng-model="row.finalQuantity">
                            </td>
                            <td>
                              {{row.finalTotalKRW}}
                            </td>
                            <td>
                              {{translateOrderProductStatus(row.status)}}
                            </td>
                          </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="portlet grey-cascade box">
                    <div class="portlet-title">
                      <div class="caption">
                        <i class="fa fa-cogs"></i>Payments
                      </div>
                    </div>
                    <div class="portlet-body">
                      <div class="table-responsive">
                        <table class="table table-hover table-bordered table-striped">
                          <thead>
                          <tr>
                            <th width="10%">ID</th>
                            <th width="10%">Parent ID</th>
                            <th width="30%">TID</th>
                            <th width="10%">Type</th>
                            <th width="10%">Total</th>
                            <th width="10%">Currency</th>
                            <th width="5%">Method</th>
                            <th width="5%">Status</th>
                            <th width="10%"></th>
                          </tr>
                          </thead>
                          <tbody class="cell-center">
                          <tr data-ng-repeat="row in order.payments">
                            <td>
                              {{row.id}}
                            </td>
                            <td>
                              {{row.parentId}}
                            </td>
                            <td>
                              {{row.tid}}
                            </td>
                            <td>
                              {{translatePaymentType(row.type)}}
                            </td>
                            <td>
                              <div ng-if="row.type === 0">
                                {{row.data.TotPrice}}
                              </div>
                              <div ng-if="row.type === 2">
                                {{row.data.PRTC_Price}}
                              </div>
                            </td>
                            <td>
                              {{row.data.currency}}
                            </td>
                            <td>
                              {{row.data.payMethod}}
                            </td>
                            <td>
                              {{translatePaymentStatus(row.status)}}
                            </td>
                            <td>
                              <div ng-if="row.type === 0">
                                <button class="btn blue" data-ng-click="popupRefund(row)">
                                  <i class="fa fa-eject"></i> 환불
                                </button>
                              </div>
                            </td>
                          </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="order_refund_modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <form data-ng-submit="refund(refundPayment, refundAmount)">
        <div class="modal-header">
          {{'order.detail.refundTitle' | translate}}
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-12 form-group">
              <label class="control-label">환불 가능 금액: {{refundPayment.data.TotPrice}} </label>
              <input class="form-control" type="number" min="1" max="{{refundPayment.data.TotPrice || 1}}" data-ng-model="refundAmount" placeholder="환불 금액을 입력하세요" />
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn default" type="reset" data-ng-click="closePopup()">{{'main.closeButton' | translate}}</button>
          <button class="btn blue" type="submit"><i class="fa fa-plus"></i> {{'main.saveButton' | translate}}</button>
        </div>
      </form>
    </div>
  </div>
</div>
